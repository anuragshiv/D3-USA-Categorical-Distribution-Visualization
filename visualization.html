<!DOCTYPE html>
<meta charset="utf-8">
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
</head>
<style>

.counties {
  fill: none;
}

.states {
  fill: none;
  stroke: #fff;
  stroke-linejoin: round;
}


.tooltip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

.title {
  font-family: sans-serif;
  font-weight : bold;
  }

.button {
  width:60%;
  height:60%;
  transition: width 0.5s,height 0.5s;
}
.button:hover {
    width: 80%; !important;
    height: 80%; !important;
}


</style>
<body id="body">
<br> 
<div class="row" align="center">
   <div class="col-lg-1" style="font-size: 90%" align="center">
  <p id="cloud1" >Cloud</p>
  </div>
  <div class="col-lg-1" style="font-size: 90%" align="center">  
  <p id="travel1">Travel</p>   
  </div>
  <div class="col-lg-1" style="font-size: 90%" align="center"> 
   <p id="security1">Security</p>
   </div>
  <div class="col-lg-1" style="font-size: 90%" align="center"> 
  <p id="social1">Social</p>
   </div>
  <div class="col-lg-1" style="font-size: 90%" align="center"> 
  <p id="ecommerce1">e-Commerce</p>
   </div>
  <div class="col-lg-1" style="font-size: 90%" align="center">   
  <p id="analy1">Analytics</p>
   </div>
      <div class="col-lg-1" style="font-size: 90%" align="center">
  <p id="gaming1">Gaming</p>
  </div>
  <div class="col-lg-1" style="font-size: 90%" align="center">  
  <p id="mobile1">Mobile</p>  
   </div>
  <div class="col-lg-1" style="font-size: 90%" align="center"> 
   <p id="food1">Food</p>
   </div>
  <div class="col-lg-1" style="font-size: 90%" align="center"> 
  <p id="health1">Health</p>
   </div>
  <div class="col-lg-1" style="font-size: 90%" align="center"> 
  <p id="finance1">Banking and Finance</p>
   </div>
  <div class="col-lg-1" style="font-size: 90%" align="center">   
  <p id="wireless1">Wireless Services</p>
   </div>
 </div>  
<div class="row" align="center">
  <div class="col-lg-1" align="center">
  <img id = "cloud" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/cloud_zps3yb3pgtq.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)" class="button" >
  </div>
  <div class="col-lg-1" align="center">  
  <img id = "travel" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/travel_zps78u6tqpr.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)"  class="button">
   </div>
  <div class="col-lg-1" align="center"> 
  <img id = "security" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/security_zpszpvdwgka.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)" class="button">
   </div>
  <div class="col-lg-1" align="center"> 
  <img id = "social" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/social_zpsqsncjwry.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)"  class="button">
   </div>
  <div class="col-lg-1" align="center"> 
  <img id = "ecommerce" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/ecommerce_zps1z3fv5rv.png" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)"  ONCLICK ="clicked(this)" class="button">
   </div>
  <div class="col-lg-1" align="center">   
  <img id = "analy" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/analysis_zpst5x11mal.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)" class="button">
   </div>
     <div class="col-lg-1" align="center"> 
  <img id = "gaming" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/gaming_zps1d7ple9x.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)"  class="button">
   </div>  
  <div class="col-lg-1" align="center"> 
  <img id = "mobile" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/mobile_zpsbe7wuv5j.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)"  class="button">
   </div>      
     <div class="col-lg-1" align="center"> 
  <img id = "food" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/food_zps0f3asdvf.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)"  class="button">
   </div> 
        <div class="col-lg-1" align="center"> 
  <img id = "health" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/health_zpsmz0btr1u.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)"  class="button">
   </div>
     <div class="col-lg-1" align="center"> 
  <img id = "finance" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/bank_zpskgsq0wzb.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)"  class="button">
   </div>  
  <div class="col-lg-1" align="center"> 
  <img id = "wireless" src="http://i1082.photobucket.com/albums/j362/Anurag_Shiv/wireless_zpsgpqfc6sr.png" ONCLICK ="clicked(this)" onmouseover="recolor(this,0)" onmouseout="recolor(this,1)"  class="button">
   </div>
     </div>
    
<HR id="line" WIDTH="100%" >
<p id="title" align="center" style="font-size: 200%;font-weight:bold"></p>
</body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/queue.v1.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script src="d3.tip.v0.6.3.js"></script>
<script>

var states= [];
var dataset =[];
var category = "social";
var width = 1280,
  height = 600;
var svg = d3.select("body").append("svg")
		  .attr("id","svg1")
          .attr("width", width)
          .attr("height", height)
drawMap();
var flag = 0;
var state_name = { 1:"ALABAMA", 2:"ALASKA", 4 :"ARIZONA",5 :"ARKANSAS",6 :"CALIFORNIA"  ,8 :"COLORADO"  ,9 :"CONNECTICUT"  ,10  :"DELAWARE"  ,11 : " WASHINGTON DC"  ,12 : "FLORIDA" ,13 : "GEORGIA"  ,15 : "HAWAII"  ,16 : "INDIANA"  ,17  :"ILLINOIS" , 18: "INDIANA",19  :"IOWA",20:  "KANSAS" ,21 : "KENTUCKY" ,22 : "LOUISIANA" ,23 : "ME"  ,24 : "MARYLAND"  ,25:"MASSACHUSSETS"  ,26: "MICHIGAN" ,27 :"MINNESOTA"  ,28  :"MISSISSIPPI" ,29: "MISSOURI"  ,30: "MONTANA",31: "NEBRASKA" ,32  :"NEVADA" ,33 : "NEW HAMPSHIRE" ,34  : "NEW JERSEY" ,35 : "NEW MEXICO" ,36 : "NEW YORK" ,37 : "NORTH CAROLINA",38 : "NORTH DAKOTA" ,39 : "OHIO",40 : "OKLAHOMA" ,41 : "OREGON" ,42 : "PENNSYLVANIA",44 : "RHODE ISLAND" ,45 : "SOUTH CAROLINA" ,46 : "SOUTH DAKOTA"  ,47 : "TENNESSEE"  ,48 : "TEXAS",49  :"UTAH",50 : "VERMONT" ,51 : "VIRGINIA" , 53 : "WASHINGTON"  ,54  :"WEST VIRGINIA" ,55 : "WISCONSIN"  ,56  : "WYOMING" ,60:  "AS",64 : "FM" ,66  :"GU" ,68 : "MH",69  :"MP"  ,70 : "PW" , 72  :"PR"  ,74:  "UM" ,78 : "VI" };

var state_id = [ [1,"AL"] , [2 , "AK"], [4 ,"AZ"],[5 ,"AR"],[6 ,"CA"  ],[8 ,"CO"  ],[9 ,"CT"  ],[10  ,"DE"  ],[11 , "DC"  ],[12 , "FL" ],[13 , "GA"  ],[15 , "HI"  ],[16,  "ID"  ],[17  ,"IL" ],[ 18,  "IN"],[19  ,"IA"],[20,  "KS" ],[21 , "KY" ],[22 , "LA" ],[23 , "ME"  ],[24 , "MD"  ],[25 , "MA"  ],[26,  "MI" ],[27 , "MN"  ],[28  ,"MS" ],[29,  "MO"  ],[30 , "MT"],[31 , "NE" ],[32  ,"NV" ],[33 , "NH" ],[34  ,"NJ" ],[35,  "NM" ],[36 , "NY" ],[37 , "NC"],[38 , "ND" ],[39 , "OH"],[40 , "OK" ],[41 , "OR" ],[42 , "PA"],[44 , "RI" ],[45 , "SC" ],[46 , "SD"  ],[47 , "TN"  ],[48 , "TX"],[49  ,"UT"],[50 , "VT" ],[51 , "VA" ],[ 53 , "WA"  ],[54  ,"WV" ],[55 , "WI"  ],[56  , "WY" ],[60,  "AS"],[64 , "FM" ],[66  ,"GU" ],[68 , "MH"],[69  ,"MP"  ],[70 , "PW" ],[72  ,"PR"  ],[74,  "UM" ],[78 , "VI" ]];

var primary_cols = {"cloud":"#00BCD4","wireless":"#2196F3","mobile":"#673AB7","ecommerce":"#FFC107","social":"#18FFFF","gaming":"#8BC34A","food":"#F44336","health":"#FFEB3B","finance":"#9E9E9E","travel":"#E91E63","security":"#009688","analy":"#FF5722"};
var colors_by_cat = {};
var maxes = {"cloud":600,"wireless":120,"mobile":1300,"ecommerce":300,"social":1500,"gaming":140,"food":90,"health":250,"finance":120,"travel":140,"security":190,"analy":380};
var main_tags = ["wireless","cloud","mobile", "ecommerce","social","gaming","food","health","finance","travel","security","analy"]

colors_by_cat["cloud"] = ["#E0F7FA","#80DEEA","4DD0E1","#26C6DA","#00BCD4","#00ACC1","0097A7","00838F","#016b75"];
colors_by_cat["travel"] = ["#FCE4EC","#F8BBD0","#F48FB1","#F06292","#EC407A","#D81B60","#C2185B","#AD1457","#880E4F"]
colors_by_cat["security"] = ["#E0F2F1","#B2DFDB","#80CBC4","#4DB6AC","#009688","#00897B","#00796B","#00695C","#004D40"]
colors_by_cat["social"] = ["#E0F7FA","#6ceded","#B2EBF2","#84FFFF","#18FFFF","#00E5FF","#00B8D4","#01a1b9","#037283"]
colors_by_cat["ecommerce"] = ["#FFECB3","#FFE082","#FFD54F","#FFC107","#FFB300","#FFA000","#FF8F00","#FF6F00","#db6002"]
colors_by_cat["analy"] = ["#FBE9E7","#FFCCBC","#FFAB91","#FF8A65","#FF5722","#F4511E","#E64A19","#D84315","#BF360C"] 
colors_by_cat["food"] = ["#FFEBEE","#FFCDD2","#EF9A9A","#E57373","#EF5350","#F44336","#E53935","#C62828","#B71C1C"]
colors_by_cat["mobile"] = ["#F3E5F5","#E1BEE7","#CE93D8","#BA68C8","#AB47BC","#9C27B0","#7B1FA2","#6A1B9A","#4A148C"]
colors_by_cat["gaming"] = ["#DCEDC8","#C5E1A5","#AED581","#9CCC65","#7CB342","#689F38","#558B2F","#33691E","#2b571a"]
colors_by_cat["health"] = ["#FFF9C4","#FFF59D","#FFF59D","#FFF176","#FFEB3B","#FDD835","#ffd000","#e4be15","#d7b314"]
colors_by_cat["finance"] = ["#F5F5F5","#EEEEEE","#E0E0E0","#BDBDBD","#9E9E9E","#757575","#616161","#424242","#212121"] 
colors_by_cat["wireless"] = ["#E3F2FD","#BBDEFB","#90CAF9","#64B5F6","#42A5F5","#2196F3","#1E88E5","#1976D2","#1565C0","#0D47A1"]


var legend_by_cat = {};
legend_by_cat["cloud"] = ["0 - 166", "167 - 333", "334 - 500", "501 - 667", "668 - 834", "835 - 1001", "1002 - 1168", "1169 - 1335", "1336 - 1502"];
legend_by_cat["travel"] = ["0 - 15", "16 - 31", "32 - 47", "48 - 63", "64 - 79", "80 - 95", "96 - 111", "112 - 127", "128 - 143"];
legend_by_cat["security"] = ["0 - 20", "21 - 41", "42 - 62", "63 - 83", "84 - 104", "105 - 125", "126 - 146", "147 - 167", "168 - 188"];
legend_by_cat["social"] = ["0 - 166", "167 - 333", "334 - 500", "501 - 667", "668 - 834", "835 - 1001", "1002 - 1168", "1169 - 1335", "1336 - 1502"];
legend_by_cat["ecommerce"] = ["0 - 32", "33 - 65", "66 - 98", "99 - 131", "132 - 164", "165 - 197", "198 - 230", "231 - 263", "264 - 296"];
legend_by_cat["analy"] = ["0 - 41", "42 - 83", "84 - 125", "126 - 167", "168 - 209", "210 - 251", "252 - 293", "294 - 335", "336 - 377"];
legend_by_cat["food"] = ["0 - 9", "10 - 19", "20 - 29", "30 - 39", "40 - 49", "50 - 59", "60 - 69", "70 - 79", "80 - 89"];
legend_by_cat["mobile"] = ["0 - 143", "144 - 287", "288 - 431", "432 - 575", "576 - 719", "720 - 863", "864 - 1007", "1008 - 1151", "1152 - 1295"];
legend_by_cat["gaming"] = ["0 - 15", "16 - 31", "32 - 47", "48 - 63", "64 - 79", "80 - 95", "96 - 111", "112 - 127", "128 - 143"];
legend_by_cat["health"] = ["0 - 27", "28 - 55", "56 - 83", "84 - 111", "112 - 139", "140 - 167", "168 - 195", "196 - 223", "224 - 251"];
legend_by_cat["finance"] = ["0 - 12", "13 - 25", "26 - 38", "39 - 51", "52 - 64", "65 - 77", "78 - 90", "91 - 103"];
legend_by_cat["wireless"] = ["0 - 12", "13 - 25", "26 - 38", "39 - 51", "52 - 64", "65 - 77", "78 - 90", "91 - 103", "104 - 116"];

var max = 0, min = 0;

function recolor(but,flag1){
  if (flag1 == 0){
    id = but.id + "1";
    var txt = document.getElementById(id);
    txt.style.fontWeight = 'bold';
    txt.style.fontSize = '99%';
    category = but.id;

  }

  else if(flag1 == 1){
    id = but.id + "1";
    var txt = document.getElementById(id);
    txt.style.fontWeight = 'normal';
    txt.style.fontSize = '100%'; 
  category = but.id;
  }
}
function drawMap(){

  if(flag == 1){
  svg.selectAll("g").remove();
  svg.selectAll(".legend").remove();
  legend_text = [];
}
      d3.csv("data.csv", function(error, data) { 
        dataset = data.map(function(d){ 

                var sat_val =0;
                if(states.indexOf(d["state_code"])==-1)
                  states[d["state_code"]]=1;
                if(d[category]=="NULL")
                  sat_val = 0;
                else
                  sat_val = d[category];  	  	
              	  legend_text = legend_by_cat[category];
                  colors = colors_by_cat[category];

                  $('#title').html($('#'+category+"1").html());
                  var title = document.getElementById("title");
                  title.style.color = primary_cols[category];
                  if(category == "social" || category == "health" || category == "finance"){
                  	title.style.color = colors_by_cat[category][6];
                  }
                return [ d["state_code"], sat_val ]});
        //console.log("dataset");
        dataset.sort();

        function find_id(current_state)
        {
          for(var i=0;i<state_id.length;i++)
          {
            if(state_id[i][1]==current_state)
              return state_id[i][0];
          }
          return -1;
        }


      var current_state = dataset[0][0];
      var total =0;
      var count = 0;
      var state_avg =[];


      function find_average(current_state)
        {
          for(var i=0;i<state_avg.length;i++)
          {
            if(state_avg[i][0]==current_state)
              return state_avg[i][1];
          }
          return -1;
        }


      var tooltip = d3.tip()
          .attr('class', 'tooltip')
          .offset([0, 0])
          .html(function(d) { 

             return state_name[d.id];

         });


        //calculating average per state

        for (j=0; j<dataset.length;j++)
        {
          if(dataset[j][0] == current_state)
          {
              total+= parseInt(dataset[j][1]);
              if(parseInt(dataset[j][1])!=0)
                count+=1;

          }

          else
          {

              var average = total;
              if(isNaN(average))
                average =0;
              var current_state_id = find_id(current_state);
              state_avg.push([current_state_id, average]);
              count =0;
              total =0;
              average = 0;
              current_state = dataset[j][0];
          }
        }




        var rateById = d3.map();
        for(var i=0;i<dataset.length;i++)
        {
          rateById.set(find_id(dataset[i][0]), dataset[i][1]);
        }


        var quantize = d3.scale.quantize()
          .domain([0,maxes[category]])
          .range(d3.range(9).map(function(i) { return colors[i] }));

        var projection = d3.geo.albersUsa()
          .scale(1200)
          .translate([width / 2, height / 2]);

        var path = d3.geo.path()
          .projection(projection);



      queue()
          .defer(d3.json, "us-10m.json")
          .await(ready);

      function ready(error, us) {
        if (error) throw error;

        //calling tooltip
        svg.call(tooltip);

        svg.append("g")
            .attr("class", "states")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.states).features)
            .enter().append("path")
            .attr("fill", function(d) { 
              return quantize(rateById.get(d.id)); })
            .attr("d", path)
            .on('mouseover', tooltip.show)
            .on('mouseout', tooltip.hide);
        
        
        svg.append("path")
            .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
            .attr("class", "states")
            .attr("d", path);
      }

      d3.select(self.frameElement).style("height", height + "px");

      //adding legend
       var   legend = svg.selectAll(".legend")
                              .data(legend_text)
                              .enter()
                              .append("g")
                              .attr("id","leg1")
                              .attr("class", "legend")
                              .attr("transform",function(d, i) { return "translate(0," + ((i * 50)+100) + ")"; });
            legend.append("circle")
            .attr("cx", width-50)
            .attr("r", 15)
            .style("fill", function(d,i){ return colors[i];});

            legend.append("text")
            .attr("x", width - 70)
            .attr("y", 0)
            .attr("dy", ".35em")
            .style("text-anchor", "end")
            .style("font-size","120%")
            .text(function(d) { return d; });


  //       var elem = document.createElement("img");
  //       elem.setAttribute("src", "http://i1082.photobucket.com/albums/j362/Anurag_Shiv/cloud_zps3yb3pgtq.png");
		// elem.setAttribute("height", "100");
		// elem.setAttribute("width", "100");
		// elem.setAttribute("alt", "Flower");
		// var sg = document.getElementById("svg1");
		// sg.appendChild(elem);
		// console.log(sg);




      });
}


function clicked(but){
  flag = 1;
  category = but.id;
  drawMap();
}

</script>